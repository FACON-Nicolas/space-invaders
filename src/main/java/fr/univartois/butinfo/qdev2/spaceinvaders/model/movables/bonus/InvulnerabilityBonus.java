/**
 * Ce fichier fait partie du projet projet-2022-2023.
 *
 * (c) 2023 nicolas
 * Tous droits réservés.
 */

package fr.univartois.butinfo.qdev2.spaceinvaders.model.movables.bonus;

import fr.univartois.butinfo.qdev2.spaceinvaders.model.SpaceInvadersGame;
import fr.univartois.butinfo.qdev2.spaceinvaders.model.movables.EtatVaisseau;
import fr.univartois.butinfo.qdev2.spaceinvaders.model.movables.PlayerShip;
import fr.univartois.butinfo.qdev2.spaceinvaders.view.SpriteStore;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.util.Duration;

/**
 * Le type InvulnerabilityBonus
 *
 * @author nicolas
 *
 * @version 0.1.0
 */
public class InvulnerabilityBonus extends AbstractBonus {

    /**
     * Crée une nouvelle instance de InvulnerabilityBonus.
     * @param game
     * @param xPosition
     * @param yPosition
     * @param sprite
     */
    public InvulnerabilityBonus(SpaceInvadersGame game, double xPosition, double yPosition) {
        super(game, xPosition, yPosition, SpriteStore.getInstance().getSprite("ufo"));
    }

    /*
     * (non-Javadoc)
     *
     * @see fr.univartois.butinfo.qdev2.spaceinvaders.model.movables.bonus.AbstractBonus#giveBonus(fr.univartois.butinfo.qdev2.spaceinvaders.model.movables.PlayerShip)
     */
    @Override
    public void giveBonus(PlayerShip player) {
        if (!isConsumed() && player.getEtat().getState() != EtatVaisseau.INVULNERABLE) {
           Timeline timeline = new Timeline(
                   new KeyFrame(
                           Duration.seconds(5), 
                           e -> {
                               player.setEtat(player.getEtat().nextState());
                               player.setSprite(game.getSpriteStore().getSprite("ship"));
                           }
                   ));
           player.setEtat(player.getEtat().nextState());
           player.setSprite(game.getSpriteStore().getSprite("ufo"));
           timeline.play();
           consume();
        }
    }
    
    

}

